# 3. 数据链路层

## 数据链路层的功能

> 加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路

### 为网络层提供服务

> 将源机器中来自网络层的数据传输到目标机器的网络层

1. 无确认的无连接服务
2. 有确认的无连接服务
3. 有确认的面向连接的服务

### 链路管理

连接的建立、维持和释放

### 帧定界、帧同步与透明传输

- 帧定界：帧首部尾部中的控制信息，用于确定帧的界限
- 帧同步：接收方能从接收到的二进制比特流中区分出帧的起始和终止
- 透明传输：不管数据出现什么组合，都能在链路上传输

### 流量控制

限制发送方的数据流量，使其发送速率不超过接收方的接收能力

:heavy_exclamation_mark:非数据链路层独有。数据链路层控制==相邻两结点==之间数据链路上的流量；传输层控制==端到端==之间的流量。

OSI 体系结构中数据链路层有流量控制功能，TCP/IP 体系中，流量控制被移到了传输层。

### 差错控制

> 使发送方确定接收方是否正确收到其发送的各种数据的方法

循环冗余校验（CRC）

## 组帧

出错时只重发出错的帧，而不必发送全部数据

### 字符计数法

> 帧头部使用一个计数字段来标明帧内字符数

### 字符填充的首位定界符法

> 使用特定字符来定界一帧的开始与结束

### 零比特填充的首位标志法

> 允许数据帧包含任意个数的比特，也允许每个字符的编码包含任意个数的比特。
>
> 发送方在遇到5个连续的“1”时，自动在其后插入一个“0”；接收方每收到5个连续的“1”时，自动删除后面紧跟的“0”

### 违规编码法

> 借助违规编码定界

只适用于采用冗余编码的特殊编码环境

## 差错控制

### 检错编码

都采用冗余编码技术

#### 奇偶校验码

n-1 位信息位与 1 位校验位组成

- 奇校验：附加校验位后，1 的个数为奇数
- 偶校验：附加校验位后，1 的个数为偶数

#### 循环冗余码（Cyclic Redundancy Code, CRC）

$1110011 \to X^6 + X^5 + X^4 + X + 1$

给定一个 m bit 的帧或报文，发送器生成一个 r bit 的序列，称为**帧校验序列**（FCS）。形成的帧由 m + r 比特组成。发送方和接收方事先商定一个多项式 G(x)（最高位和最低位必须是1），使得带校验码的帧刚好能被这个多项式整除。

给定 G(x) = 1101（阶数 r = 3），待传送数据 M = 101001（m = 6），模2除法运算后结果：商 Q = 110101（没用），余数 R = 001。发送出去的数据为 101001 001（$2^rM + FCS$），共 m+r 位。

CRC 具有纠错功能，数据链路层只使用了检错功能。

### 纠错编码

以 1010 为例

#### 海明码位数

设 n 为信息位数，k 为校验位的位数，需满足

$n + k \le 2^k - 1$

$n + k = 7 \le 2^3 - 1$，信息位4位，校验位3位

#### 海明码分布

校验位$P_i$ 在海明位号为 $2^{i-1}$位置上
$$
H_7 \quad H_6 \quad H_5 \quad H_4 \quad H_3 \quad H_2 \quad H_1\\
D_4 \quad D_3 \quad D_2 \quad P_3 \quad D_1 \quad P_2 \quad P_1
$$

#### 分组校验

![分组校验关系](https://raw.githubusercontent.com/BluePrintYang/PicHub/master/premaster/image-20230930164105457.png)

#### 校验位取值

$$
\begin{aligned}
&P_{1} =D_1\oplus D_2\oplus D_4=0\oplus1\oplus1=0  \\
&P_{2} =D_1\oplus D_3\oplus D_4=0\oplus0\oplus1=1  \\
&P_{3} =D_2\oplus D_3\oplus D_4=1\oplus0\oplus1=0 
\end{aligned}
$$

对应海明码为$101\underline{0}0\underline{10}$

#### 校验原理

$$
\begin{gathered}
S_1 =P_1\oplus D_1\oplus D_2\oplus D_4 \\
S_2 =P_2\oplus D_1\oplus D_3\oplus D_4 \\
S_3 =P_3\oplus D_2\oplus D_3\oplus D_4 
\end{gathered}
$$

若$S_1S_2S_3$为000，则无错；否则出错，这个数就是错误位的位号

## 流量控制与可靠传输机制

### 流量控制、可靠传输与滑动窗口机制

接收方控制发送方发送数据的速率

#### 停止-等待流量控制基本原理

发送方每发送一帧，等待接收方的应答信号，之后才能发送下一帧；接收方每接收一帧，都要反馈一个应答信号。

每次只允许发送一帧，传输效率低。

#### 滑动窗口流量控制基本原理

- 发送窗口：发送方维持一组连续的允许发送的帧的序号
- 接收窗口：接收方维护一组连续的允许接收帧的序号
- 发送窗口$W_T$：在还未收到对方确认信息的情况下，发送方最多还可以发送多少个数据帧
- 接收窗口：控制可以接收哪些数据帧和不可以接收哪些数据帧

发送方每收到一个确认帧，发送窗口向前滑动一个帧的位置；接收方收到数据帧后，将窗口向前滑动一个位置，并发回确认帧，收到的数据在接收窗口之外，一律丢弃。

特征：

1. 只有接收窗口向前滑动时，发送窗口才有可能向前滑动
2. 停止-等待协议、后退N帧协议和选择重传协议只在发送窗口大小和接收窗口大小有所差别
   1. 停止-等待协议：发送窗口大小=1，接收窗口大小=1
   2. 后退N帧协议：发送窗口大小>1，接收窗口大小=1
   3. 选择重传协议：发送窗口大小>1，接收窗口大小>1
3. 接收窗口大小为1时，可保证帧的有序接收
4. 数据链路层的滑动窗口协议中，窗口大小在传输过程中是固定的

#### 可靠传输机制

- 确认
- 超时重传

### 单帧滑动窗口与停止-等待协议

> 发送窗口大小=1，接收窗口大小=1

### 多帧滑动窗口与后退N帧协议（GBN）

> 发送窗口大小>1，接收窗口大小=1

不一定每个数据帧都发回一个确认帧

积累确认：对某一数据帧的确认表示该数据帧和之前所有的数据帧都已正确接收

接收方只允许按顺序接收帧

:star2:若采用 n 比特对帧编号，发送窗口尺寸 $W_T$ 需满足$1 \lt W_T \le 2^n - 1$。若超过，则会造成接收方无法分辨新帧和旧帧。

信道质量很差导致误码率较大时，不一定优于停止等待协议。

### 多帧滑动窗口与选择重传协议（SR）

> 发送窗口大小>1，接收窗口大小>1

接收窗口和发送窗口大小==通常==是相同的，且最大值都为序号的范围的一半。若采用 n 比特对帧编号，$W_{Tmax} = W_{Rmax} = 2^{n-1}$

可以避免重复传送那些本已正确接收的数据帧，但在接收端要设置具有相当容量的缓冲区来暂存那些未按序正确接收到的帧。缓冲区的数目等于窗口的大小。

## 介质访问控制

> 使两对结点之间通信不会发生互相干扰

介质访问控制（Medium Access Control，MAC）

### 信道划分介质访问控制

通过分时、分频、分码等方法把原来的一条广播信道，逻辑上分为几条用于两个结点之间通信的互不干扰的子信道，实际上就是把广播信道转变为点对点信道。

#### 频分多路复用（FDM）

#### 时分多路复用（TDM）

#### 波分多路复用（WDM）

#### 码分多路复用（CDM）

### 随机访问介质访问控制

将广播信道转变为点对点信道

争用型协议

#### ALOHA协议

1. 纯ALOHA协议
2. 时隙ALOHA协议

#### CSMA协议（Carrier Sense Multiple Access）

载波监听，在发送前监听一下信道

1. 1-坚持型CSMA：空闲发；忙等待，继续监听
2. 非坚持型CSMA：空闲发；忙放弃，等待随机后重复
3. p-坚持型CSMA

#### CSMA/CD协议

#### CSMA/CA协议

![CSMA/CA工作原理](https://raw.githubusercontent.com/BluePrintYang/PicHub/master/premaster/o6sdw0.png)

![image-20230821135126273](https://raw.githubusercontent.com/BluePrintYang/PicHub/master/premaster/he5r2s.png)

### 轮训访问：令牌传递协议

## 局域网

### 局域网的基本概念和体系结构

### 以太网与IEEE 802.3

#### 以太网的传输介质和网卡

#### 以太网的MAC帧

#### 高速以太网

### IEEE 802.11 无线局域网

#### 无线局域网的组成

#### 802.11 局域网的MAC帧

### VLAN基本概念与基本理论

## 广域网

### 广域网的基本概念

### PPP协议

### HDLC协议

## 数据链路层设备

### 网桥的基本概念

### 局域网交换机

#### 交换机的原理和特点

#### 交换机的自学习功能